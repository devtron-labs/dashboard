import React, { useEffect, useState } from 'react'
import Tippy from '@tippyjs/react'
import { ReactComponent as Question } from '../../../../assets/icons/ic-help-outline.svg'
import { ReactComponent as Bug } from '../../../../assets/icons/ic-nav-bug.svg'
import { ReactComponent as Secure } from '../../../../assets/icons/ic-secure.svg'
import { noop } from '@devtron-labs/devtron-fe-common-lib'
import { SecurityVulnerabilityCardType } from './appDetails.type'
import LoadingCard from './LoadingCard'

export const SecurityVulnerabilityCard = ({
    cardLoading,
    showVulnerabilitiesModal,
    severityCount,
}: SecurityVulnerabilityCardType) => {
    const { critical = 0, moderate = 0, low = 0 } = severityCount
    const totalCount = critical + moderate + low || 0

    if (cardLoading) return <LoadingCard />

    return (
        <div
            data-testid="security-vulnerability-card"
            onClick={cardLoading ? noop : showVulnerabilitiesModal}
            className="app-details-info-card pointer flex left bcn-0 br-8 mr-12 lh-20 w-200"
        >
            <div className="app-details-info-card__top-container flex">
                <div className="app-details-info-card__top-container__content">
                    <div className="app-details-info-card__top-container__content__title-wrapper">
                        <div className="fs-12 fw-4 cn-7 mr-5">Security</div>
                        <Tippy
                            className="default-tt"
                            arrow={false}
                            placement="top"
                            content="Security scan result for the currently deployed image"
                        >
                            <Question className="icon-dim-16 mt-2" />
                        </Tippy>
                    </div>
                    <div className="app-details-info-card__top-container__content__commit-text-wrapper flex fs-12 fw-4">
                        {!totalCount ? (
                            <div className="dc__info-title lh-20 ">You're secure!</div>
                        ) : (
                            <div className="fs-13 fw-6 lh-20 f-waiting">{totalCount} Vulnerabilities</div>
                        )}
                    </div>
                </div>
                {!totalCount ? <Secure /> : <Bug className="scy-7" />}
            </div>
            <div className="app-details-info-card__bottom-container">
                <span className="app-details-info-card__bottom-container__message mr-2 fs-12 fw-4">
                    {!totalCount
                        ? 'No Vulnerabilities found'
                        : `${critical} Critical, ${moderate} Moderate, ${low} Low`}
                </span>
                <div className="app-details-info-card__bottom-container__details fs-12 fw-6">Details</div>
            </div>
        </div>
    )
}

export default React.memo(SecurityVulnerabilityCard)
